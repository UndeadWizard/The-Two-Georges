# Divided Monarchists
usa_set_election_1836_variables = {
	#Tory Variables
	set_variable = { name = bonapartist_progress_from_characters value = 0 } #Progress-from-character component. This updates with the combined popularities of every Bonapartist character later on, and is used to calculate monthly progress in the progress bar.
	set_variable = { name = bonapartist_progress_from_igs value = 0 } #Progress-from-IG component. This updates with the combined clout of every Bonapartist IG later on, and is used to calculate monthly progress in the progress bar.
	set_variable = { name = bonapartist_progress_from_military value = 0 } #Progress-from-military-building component. This updates with the sum of military building levels in France later on, and is used to calculate monthly progress in the progress bar.
	set_variable = { name = bonapartist_progress_from_legitimacy value = 0 } #Progress-from-legitimacy component. This updates with the current government legitimacy, and is also used to calculate monthly progress in the progress bar.
	set_variable = { name = bonapartist_progress_from_movements value = 0 } #Progress-from-movements component. This depends upon the support of various movements, and is also used to calculate monthly progress in the progress bar.
	set_variable = { name = bonapartist_progress_from_effects value = 0 } #Final element in the progress bar. This is defined by various effects, and is based solely on scripted effects. This is how designers can manually grant ticking bonuses or maluses to this mechanic.

	#Whig Variables
	set_variable = { name = orleanist_progress_from_characters value = 0 }
	set_variable = { name = orleanist_progress_from_igs value = 0 }
	set_variable = { name = orleanist_progress_from_factories value = 0 } #These variables use the same scheme as the Bonapartist ones, with the exception that Orleanists derive from the sum of light/heavy industry building levels in France.
	set_variable = { name = orleanist_progress_from_legitimacy value = 0 }
	set_variable = { name = orleanist_progress_from_movements value = 0 }
	set_variable = { name = orleanist_progress_from_effects value = 0 }

	set_variable = { name = ig_weight value = 0 } #This variable is used solely for mathematical purposes, and is set as equivalent to the clout of a given interest group. It exists so that IGs can be weighted higher or lower depending on whether they're in-government or not.
}

usa_weekly_pulse_tory_progress = { #Effects like these are run three times, one for each house. All of them function essentially the same way.
	set_variable = { name = bonapartist_progress_from_characters value = 0 } #All of these variables are ephemeral and should never be manually set to anything.
	set_variable = { name = bonapartist_progress_from_igs value = 0 }
	set_variable = { name = bonapartist_progress_from_military value = 0 }
	set_variable = { name = bonapartist_progress_from_movements value = 0 }
	set_variable = { name = bonapartist_progress_from_legitimacy value = root.government_legitimacy } #Government legitimacy is a single constant, and so this variable is set immediately rather than needing a calculation.
	#From Characters
	every_scope_character = {
		limit = {
			has_ideology = ideology:ideology_bonapartist
		}
		ROOT = {
			change_variable = { name = bonapartist_progress_from_characters add = prev.popularity } #for_each loop. For each character of ideology_bonapartist, add that character's popularity to bonapartist_progress_from_characters.
		}
	}
	change_variable = { name = bonapartist_progress_from_characters divide = 100 } #Character popularities are -100/100, rather than our desired -1/1, so divide by 100.
	# From Interest Groups
	every_interest_group = {
		limit = {
			leader = {
				has_ideology = ideology:ideology_bonapartist
			}
		}
		ROOT = {														#for_each loop. For each interest group of ideology_bonapartist, perform the following steps in sequence.
			set_variable = { name = ig_weight value = prev.ig_clout } 	#1. Set ig_weight as equal to the interest group's clout.
		}
		if = {
			limit = {
				is_in_government = yes
			}
			ROOT = {
				change_variable = { name = ig_weight multiply = 2 }		#2. If that IG is in government, multiply ig_weight by a given value.
			}
		}
		ROOT = {
			change_variable = { name = bonapartist_progress_from_igs add = var:ig_weight }	#3. Add ig_weight to the central bonapartist_progress_from_igs variable. This will run until there are no more Bonapartist IGs.
		}
	}
	# From Buildings
	every_scope_building = {
		limit = {
			is_building_group = bg_military # Derives from barracks and naval bases.
			occupancy >= 0.5
		}
		ROOT = {
			change_variable = { name = bonapartist_progress_from_military add = prev.level } #for_each loop, uses similar context to the character component. Iterates through every building in the country matching the filter, gets that building's level, and adds it to the central bonapartist_progress_from_military variable.
		}
	}
	change_variable = { name = bonapartist_progress_from_military divide = 150 } #Building levels are converted to decimal. This usually equals something between 1 and 3, with 0.01 = one building level.
	# From Movements
	if = {
		limit = {
			any_political_movement = {
				is_political_movement_type = movement_bonapartist
			}
		}
		random_political_movement = {
			limit = {
				is_political_movement_type = movement_bonapartist
			}
			ROOT = {
				set_variable = { name = bonapartist_progress_from_movements value = prev.political_movement_support }
				change_variable = { name = bonapartist_progress_from_movements multiply = 10 }
			}
		}
	}
	# From Legitimacy
	change_variable = { name = bonapartist_progress_from_legitimacy divide = 100 } #Legitimacy divided by 100, to make it minimum 0 and maximum 1.
	change_variable = { name = bonapartist_progress_from_legitimacy subtract = 0.5 } #Legitimacy subtracted by 0.5, to make it minimum -0.5 and maximum 0.5. Balanced scale of negative to absolute value.
	if = {
		limit = {
			NOT = {
				ruler_is_bonapartist = yes #If the ruler is Bonapartist, then the Bonapartists benefit from high legitimacy and suffer from low legitimacy.
			}
		}
		change_variable = { name = bonapartist_progress_from_legitimacy multiply = -0.5 } #If the ruler is not Bonapartist, they benefit from low legitimacy and suffer from high legitimacy.
	}
}

usa_weekly_pulse_whig_progress = { #See Bonapartist progress to see how this works.
	set_variable = { name = orleanist_progress_from_characters value = 0 }
	set_variable = { name = orleanist_progress_from_igs value = 0 }
	set_variable = { name = orleanist_progress_from_factories value = 0 }
	set_variable = { name = orleanist_progress_from_movements value = 0 }
	set_variable = { name = orleanist_progress_from_legitimacy value = root.government_legitimacy }
	#From Characters
	every_scope_character = {
		limit = {
			has_ideology = ideology:ideology_orleanist
		}
		ROOT = {
			change_variable = { name = orleanist_progress_from_characters add = prev.popularity }
		}
	}
	change_variable = { name = orleanist_progress_from_characters divide = 100 }
	# From Interest Groups
	every_interest_group = {
		limit = {
			leader = {
				has_ideology = ideology:ideology_orleanist
			}
		}
		ROOT = {
			set_variable = { name = ig_weight value = prev.ig_clout }
		}
		if = {
			limit = {
				is_in_government = yes
			}
			ROOT = {
				change_variable = { name = ig_weight multiply = 2 }
			}
		}
		ROOT = {
			change_variable = { name = orleanist_progress_from_igs add = var:ig_weight }
		}
	}
	# From Buildings
	every_scope_building = {
		limit = {
			is_building_group = bg_manufacturing
			weekly_profit > 0
		}
		ROOT = {
			change_variable = { name = orleanist_progress_from_factories add = prev.level }
		}
	}
	change_variable = { name = orleanist_progress_from_factories divide = 100 }
	# From Movements
	if = {
		limit = {
			any_political_movement = {
				is_political_movement_type = movement_orleanist
			}
		}
		random_political_movement = {
			limit = {
				is_political_movement_type = movement_orleanist
			}
			ROOT = {
				set_variable = { name = orleanist_progress_from_movements value = prev.political_movement_support }
				change_variable = { name = orleanist_progress_from_movements multiply = 10 }
			}
		}
	}
	# From Legitimacy
	change_variable = { name = orleanist_progress_from_legitimacy divide = 100 }
	change_variable = { name = orleanist_progress_from_legitimacy subtract = 0.5 }
	if = {
		limit = {
			NOT = {
				ruler_is_orleanist = yes
			}
		}
		change_variable = { name = orleanist_progress_from_legitimacy multiply = -0.5 }
	}
}

usa_clear_election_1836_variables = { #Clears all variables, to save memory/performance. Should be executed by anything that makes Divided Monarchists irrelevant.
	remove_variable = bonapartist_progress_from_characters
	remove_variable = bonapartist_progress_from_igs
	remove_variable = bonapartist_progress_from_military
	remove_variable = bonapartist_progress_from_legitimacy
	remove_variable = bonapartist_progress_from_movements
	remove_variable = bonapartist_progress_from_effects
	remove_variable = orleanist_progress_from_characters
	remove_variable = orleanist_progress_from_igs
	remove_variable = orleanist_progress_from_factories
	remove_variable = orleanist_progress_from_legitimacy
	remove_variable = orleanist_progress_from_movements
	remove_variable = orleanist_progress_from_effects
	remove_variable = legitimist_progress_from_characters
	remove_variable = legitimist_progress_from_igs
	remove_variable = legitimist_progress_from_farms
	remove_variable = legitimist_progress_from_legitimacy
	remove_variable = legitimist_progress_from_movements
	remove_variable = legitimist_progress_from_effects
	remove_variable = ig_weight
}

usa_freeze_election_1836_progress = { #Used upon initiation of cement_the_rightful_dynasty, to prevent the bars from excessively accumulating.
	set_variable = usa_election_1836_freeze
}

# Used in IG scope
fra_disfavor_leader_ig_dynasty = {
	if = {
		limit = {
			leader = {
				has_ideology = ideology:ideology_bonapartist
			}
		}
		owner = {
			custom_tooltip = {
				text = bonapartist_progress_decrease_10_tt
				je:je_divided_monarchists = {
					add_progress = { value = -10 name = divided_monarchists_bonapartist_progress_bar }
				}
			}
		}
	}
	else_if = {
		limit = {
			leader = {
				has_ideology = ideology:ideology_orleanist
			}
		}
		owner = {
			custom_tooltip = {
				text = orleanist_progress_decrease_10_tt
				je:je_divided_monarchists = {
					add_progress = { value = -10 name = divided_monarchists_orleanist_progress_bar }
				}
			}
		}
	}
	else_if = {
		limit = {
			leader = {
				has_ideology = ideology:ideology_legitimist
			}
		}
		owner = {
			custom_tooltip = {
				text = legitimist_progress_decrease_10_tt
				je:je_divided_monarchists = {
					add_progress = { value = -10 name = divided_monarchists_legitimist_progress_bar }
				}
			}
		}
	}
}

# Used in IG scope
fra_favor_leader_ig_dynasty = {
	if = {
		limit = {
			leader = {
				has_ideology = ideology:ideology_bonapartist
			}
		}
		owner = {
			custom_tooltip = {
				text = bonapartist_progress_increase_10_tt
				je:je_divided_monarchists = {
					add_progress = { value = 10 name = divided_monarchists_bonapartist_progress_bar }
				}
			}
		}
	}
	else_if = {
		limit = {
			leader = {
				has_ideology = ideology:ideology_orleanist
			}
		}
		owner = {
			custom_tooltip = {
				text = orleanist_progress_increase_10_tt
				je:je_divided_monarchists = {
					add_progress = { value = 10 name = divided_monarchists_orleanist_progress_bar }
				}
			}
		}
	}
	else_if = {
		limit = {
			leader = {
				has_ideology = ideology:ideology_legitimist
			}
		}
		owner = {
			custom_tooltip = {
				text = legitimist_progress_increase_10_tt
				je:je_divided_monarchists = {
					add_progress = { value = 10 name = divided_monarchists_legitimist_progress_bar }
				}
			}
		}
	}
}

# Country scope
fra_favor_ruler_dynasty = {
	if = {
		limit = {
			ruler_is_bonapartist = yes
		}
		custom_tooltip = {
			text = bonapartist_progress_increase_10_tt
			je:je_divided_monarchists = {
				add_progress = { value = 10 name = divided_monarchists_bonapartist_progress_bar }
			}
		}
	}
	else_if = {
		limit = {
			ruler_is_orleanist = yes
		}
		custom_tooltip = {
			text = orleanist_progress_increase_10_tt
			je:je_divided_monarchists = {
				add_progress = { value = 10 name = divided_monarchists_orleanist_progress_bar }
			}
		}
	}
	else_if = {
		limit = {
			ruler_is_legitimist = yes
		}
		custom_tooltip = {
			text = legitimist_progress_increase_10_tt
			je:je_divided_monarchists = {
				add_progress = { value = 10 name = divided_monarchists_legitimist_progress_bar }
			}
		}
	}
}

# Country scope
fra_disfavor_ruler_dynasty = {
	if = {
		limit = {
			ruler_is_bonapartist = yes
		}
		custom_tooltip = {
			text = bonapartist_progress_decrease_10_tt
			je:je_divided_monarchists = {
				add_progress = { value = -10 name = divided_monarchists_bonapartist_progress_bar }
			}
		}
	}
	else_if = {
		limit = {
			ruler_is_orleanist = yes
		}
		custom_tooltip = {
			text = orleanist_progress_decrease_10_tt
			je:je_divided_monarchists = {
				add_progress = { value = -10 name = divided_monarchists_orleanist_progress_bar }
			}
		}
	}
	else_if = {
		limit = {
			ruler_is_legitimist = yes
		}
		custom_tooltip = {
			text = legitimist_progress_decrease_10_tt
			je:je_divided_monarchists = {
				add_progress = { value = -10 name = divided_monarchists_legitimist_progress_bar }
			}
		}
	}
}